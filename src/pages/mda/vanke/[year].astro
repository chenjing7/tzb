---
import MainLayout from '../../../layouts/MainLayout.astro';
import { marked } from 'marked';
import * as fs from 'node:fs/promises';
import * as path from 'node:path';

export function getStaticPaths() {
  return [
    { params: { year: '2024' } },
    { params: { year: '2023' } },
    { params: { year: '2022' } },
    { params: { year: '2021' } },
  ];
}

const { year } = Astro.params;
const currentYear = parseInt(year);

// 直接读取MD文件内容
let contentHtml = '';
try {
  const filePath = path.resolve(`./src/content/mda/vanke/${year}.md`);
  const fileContent = await fs.readFile(filePath, 'utf-8');
  const parsedContent = marked.parse(fileContent);
  contentHtml = typeof parsedContent === 'string' ? parsedContent : '';
} catch (error) {
  console.error(`Error reading or parsing file: ${error}`);
}

// 可用年份列表 - 降序排列
const years = [2024, 2023, 2022, 2021];
---

<MainLayout title={`万科A ${year}年度管理层讨论与分析`} activeNav="mda">
  <div class="max-w-6xl mx-auto px-4">
    <div class="flex items-center gap-4 mb-6">
      <a href="/tzb/mda" class="text-primary-600 hover:text-primary-800 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-1">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" />
        </svg>
        返回列表
      </a>
    </div>
    
    <div class="relative flex gap-16">
      <div class="card overflow-visible flex-1 max-w-content">
        <div class="p-6 border-b border-secondary-100">
          <div class="flex flex-col sm:flex-row sm:items-center gap-4">
            <div>
              <h1 class="text-2xl font-bold text-secondary-900">
                万科A
              </h1>
              <p class="text-secondary-600 mt-1 mb-0">
                {year}年度管理层讨论与分析
              </p>
            </div>
          </div>
        </div>
        
        <div class="p-8">
          <article class="mda-content" id="markdown-container">
            <div set:html={contentHtml} />
          </article>
        </div>
      </div>

      <!-- 垂直年份导航，位于右侧 -->
      <div class="year-navigation">
        {years.map(y => (
          <a 
            href={`/tzb/mda/vanke/${y}`} 
            class={`year-link ${y === currentYear ? 'active' : ''}`}
          >
            {y}年
            {y === currentYear && (
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 ml-1 inline">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
              </svg>
            )}
          </a>
        ))}
      </div>
    </div>
  </div>

  <script>
    // Import the table enhancer utility
    import { enhanceTables } from '../../../utils/tableEnhancer.js';
    
    // Initialize when the DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      enhanceTables('markdown-container');
    });
  </script>

  <style>
    .max-w-content {
      max-width: calc(100% - 120px);
    }
    
    .year-navigation {
      position: sticky;
      top: 2rem;
      height: fit-content;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      font-size: 0.9rem;
      padding-top: 1rem;
    }
    
    .year-link {
      padding: 0.5rem 0.75rem;
      color: #666;
      transition: all 0.2s;
      text-decoration: none;
      white-space: nowrap;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      border-radius: 4px;
    }
    
    .year-link:hover {
      color: #333;
      background-color: #f5f5f5;
    }
    
    .year-link.active {
      color: #f00;
      font-weight: 500;
      background-color: #fff;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    @media (max-width: 1100px) {
      .year-navigation {
        position: static;
        flex-direction: row;
        justify-content: flex-end;
        gap: 0.5rem;
        margin-bottom: 1rem;
        padding-top: 0;
      }

      .max-w-content {
        max-width: 100%;
      }

      .relative.flex.gap-16 {
        flex-direction: column;
        gap: 1rem;
      }
    }
  </style>
</MainLayout> 